<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MazeRush</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>

  <!-- === CONTAINER DO MENU PRINCIPAL === -->
  <div id="main-page" class="mazerush-menu">
    <h1 class="mazerush-title">MazeRush</h1>
    <div class="mazerush-grid" id="main-menu">
      <a href="#" class="mazerush-card mazerush-play" onclick="openLevels()">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        <span>Jogar</span>
      </a>
      <a href="#" class="mazerush-card" onclick="openProfileMenu()">
        <svg viewBox="0 0 24 24"><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/></svg>
        <span>Perfil</span>
      </a>
      <a href="#" class="mazerush-card" onclick="openSettingsMenu()">
        <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.07-.61.07-.94s-.03-.64-.07-.94l2.03-1.58a.5.5 0 0 0 .11-.64l-1.91-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.007 7.007 0 0 0-1.62-.94L14 2.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5l-.38 2.56c-.6.23-1.15.54-1.62.94l-2.39-.96a.5.5 0 0 0-.6.22l-1.91 3.32a.5.5 0 0 0 .11.64l2.03 1.58c-.04.3-.07.61-.07.94s.03.64.07.94L2.86 14.52a.5.5 0 0 0-.11.64l1.91 3.32c.14.24.44.34.7.22l2.39-.96c.47.4 1.02.72 1.62.94l.38 2.56a.5.5 0 0 0 .5.5h3c.25 0 .46-.18.5-.42l.38-2.56c.6-.23 1.15-.54 1.62-.94l2.39.96c.26.1.56 0 .7-.22l1.91-3.32a.5.5 0 0 0-.11-.64l-2.03-1.58zM12 15.5A3.5 3.5 0 1 1 15.5 12 3.5 3.5 0 0 1 12 15.5z"/></svg>
        <span>Defini√ß√µes</span>
      </a>
      <a href="#" class="mazerush-card">
        <svg viewBox="0 0 24 24"><path d="M4 17h16v2H4v-2zm0-5h16v2H4v-2zm0-5h16v2H4V7z"/></svg>
        <span>Personalizar</span>
      </a>
    </div>
    <div class="mazerush-footer">MazeRush ‚Äî v0.1 | Criado com üíõ</div>
  </div>

  <!-- === SUBMENU: PERFIS === -->
  <div id="profile-list" class="profile-panel hidden">
    <h2 class="profile-heading">Perfis</h2>
    <div class="profile-slot active" onclick="openEditPopup()" data-profile="1">
      <span id="profile-name-slot">Jogador</span>
    </div>
    <div class="profile-slot inactive">Vazio</div>
    <div class="profile-slot inactive">Vazio</div>
    <div class="profile-buttons">
      <button onclick="closeProfileMenu()">‚Üê Voltar</button>
    </div>
  </div>

  <!-- === POPUP EDI√á√ÉO PERFIL === -->
  <div id="profile-popup" class="profile-panel hidden">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 class="profile-heading" style="margin-bottom:0">Alcunha</h2>
      <button id="delete-profile" onclick="deleteProfile()" title="Eliminar Perfil"
        style="background:none;border:none;color:var(--quase-branco);font-size:1.4rem;cursor:pointer">üóëÔ∏è</button>
    </div>
    <div style="display:flex;justify-content:center;margin:12px 0">
      <input type="text" id="nickname" maxlength="12" value="Jogador"/>
    </div>
    <p style="font-size:0.9rem;margin:10px 0 20px;color:var(--quase-branco);opacity:0.8">
      Escolha uma alcunha para ser exibida na tabela de classifica√ß√£o. A sua alcunha pode ser alterada a qualquer momento.
    </p>
    <div class="profile-buttons" style="justify-content:center">
      <button id="confirm-profile" style="max-width:160px" onclick="confirmEdit()">Ok</button>
    </div>
  </div>

  <!-- === SUBMENU: DEFINI√á√ïES === -->
  <div id="settings-menu" class="profile-panel hidden">
    <h2 class="profile-heading">Defini√ß√µes</h2>
    <div class="setting-item">
      <label class="toggle-label"><input type="checkbox" id="toggle-sound"/><span class="toggle-slider"></span></label>
      <span>Som</span>
    </div>
    <input type="range" id="volume-sound" min="0" max="100"/>
    <div class="setting-item">
      <label class="toggle-label"><input type="checkbox" id="toggle-music"/><span class="toggle-slider"></span></label>
      <span>M√∫sica</span>
    </div>
    <input type="range" id="volume-music" min="0" max="100"/>
    <div class="profile-buttons" style="justify-content:center">
      <button onclick="closeSettingsMenu()">‚Üê Voltar</button>
    </div>
  </div>

  <!-- === SUBMENU: N√çVEIS === -->
  <div id="levels-page" class="hidden">
    <header class="levels-header">
      <button onclick="closeLevels()" class="back-button">‚Üê</button>
      <h1 class="levels-title">MazeRush <span style="opacity:0.6">‚Äî N√≠veis</span></h1>
      <button id="reset-btn" class="reset-button">‚ü≥ Reiniciar</button>
    </header>
    <main class="categories">
      <div class="section-heading">
        <h2>Campanha</h2>
        <div class="section-line"></div>
      </div>
      <div id="levels-container" class="levels-grid"></div>
    </main>
  </div>

  <!-- === CONTE√öDO DO JOGO === -->
  <div id="game-page" class="hidden">
    <div id="pause-overlay"></div>

    <!-- Bot√£o para alternar c√¢maras -->
    <button id="camera-toggle-btn" class="cam-btn" title="Mudar c√¢mara">
      <svg viewBox="0 0 24 24" width="20" height="20">
        <path fill="currentColor"
              d="M12 5a5 5 0 100 10 5 5 0 000-10zm0-3c1.1 0 2 .9 2 2h4c1.1 0 2 .9 2 2v10a2
                 2 0 01-2 2H6a2 2 0 01-2-2V6c0-1.1.9-2 2-2h4a2 2 0 012-2z"/>
      </svg>
    </button>

    <!-- Controles de luz -->
    <div id="light-controls">
      <label><input type="checkbox" id="toggleAmbient" checked> Luz Ambiente</label>
      <label><input type="checkbox" id="toggleDirectional" checked> Luz Direcional</label>
      <label><input type="checkbox" id="togglePoint" checked> Luz Pontual</label>
    </div>

    <!-- Canvas do Jogo -->
    <div id="game-container"></div>
    <div id="preview-text">Decora o labirinto!</div>

    <!-- Modal de Fim de N√≠vel -->
    <div id="level-complete-modal">
      <div class="modal-content">
        <h2>N√≠vel Conclu√≠do!</h2>
        <p class="time-display"></p>
        <div class="button-group">
          <button id="settings-btn">Defini√ß√µes</button>
          <button id="menu-btn">Regressar ao Menu</button>
          <button id="retry-btn">Tentar Novamente</button>
        </div>
        <button id="next-level-btn">Pr√≥ximo N√≠vel</button>
      </div>
    </div>

    <!-- Submenu Pausa -->
    <div id="pause-menu">
      <h2>Menu de Pausa</h2>
      <button class="pause-button" id="resume-btn">‚ñ∂ Continuar</button>
      <button class="pause-button" id="restart-btn">‚Üª Reiniciar</button>
      <button class="pause-button" id="exit-btn">‚è¥ Voltar ao Menu</button>
    </div>

    <!-- Minimap -->
    <div id="minimap-container">
      <canvas id="minimap" width="220" height="220"></canvas>
    </div>

    <!-- Veloc√≠metro -->
    <div id="speedometer">0&nbsp;km/h</div>
  </div>

  <!-- === SCRIPTS === -->
  <script src="js/audio.js"></script>

  <!-- l√≥gico dos menus, perfil, defs e n√≠veis -->
  <script>
    const mainPage     = document.getElementById('main-page');
    const mainMenu     = document.getElementById('main-menu');
    const footer       = document.querySelector('.mazerush-footer');
    const profileList  = document.getElementById('profile-list');
    const profilePopup = document.getElementById('profile-popup');
    const settingsMenu = document.getElementById('settings-menu');
    const levelsPage   = document.getElementById('levels-page');
    const gamePage     = document.getElementById('game-page');
    const nameSlot     = document.getElementById('profile-name-slot');
    const nickname     = document.getElementById('nickname');

    // ‚îÄ‚îÄ‚îÄ Perfil ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function openProfileMenu() {
      mainMenu.style.display = 'none';
      footer.style.display   = 'none';
      profileList.classList.remove('hidden');
    }
    function closeProfileMenu() {
      profileList.classList.add('hidden');
      mainMenu.style.display = 'grid';
      footer.style.display   = 'block';
    }
    function openEditPopup() {
      profileList.classList.add('hidden');
      profilePopup.classList.remove('hidden');
      nickname.value = localStorage.getItem('playerName') || 'Jogador';
    }
    function confirmEdit() {
      const val = nickname.value.trim();
      if (val) {
        localStorage.setItem('playerName', val);
        nameSlot.textContent = val;
      }
      profilePopup.classList.add('hidden');
      profileList.classList.remove('hidden');
    }
    function deleteProfile() {
      if (confirm('Eliminar o perfil atual?')) {
        localStorage.removeItem('playerName');
        nameSlot.textContent = 'Jogador';
      }
      profilePopup.classList.add('hidden');
      profileList.classList.remove('hidden');
    }

    // ‚îÄ‚îÄ‚îÄ Defini√ß√µes ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const toggleSound = document.getElementById('toggle-sound');
    const toggleMusic = document.getElementById('toggle-music');
    const volSound    = document.getElementById('volume-sound');
    const volMusic    = document.getElementById('volume-music');
    const updateSetting = (k,v) => {
      localStorage.setItem(k,v);
      if (typeof window.updateAudioSettings==='function')
        window.updateAudioSettings();
    };
    toggleSound.addEventListener('change', ()=> updateSetting('soundEnabled', toggleSound.checked));
    toggleMusic.addEventListener('change', ()=> updateSetting('musicEnabled', toggleMusic.checked));
    volSound .addEventListener('input',  ()=> updateSetting('soundVolume',   volSound.value));
    volMusic .addEventListener('input',  ()=> updateSetting('musicVolume',   volMusic.value));
    function openSettingsMenu() {
      mainMenu.style.display = 'none';
      footer.style.display   = 'none';
      settingsMenu.classList.remove('hidden');
      toggleSound.checked = localStorage.getItem('soundEnabled')!=='false';
      toggleMusic.checked = localStorage.getItem('musicEnabled')!=='false';
      volSound.value      = localStorage.getItem('soundVolume')  || 70;
      volMusic.value      = localStorage.getItem('musicVolume')  || 60;
    }
    function closeSettingsMenu() {
      localStorage.setItem('soundEnabled', toggleSound.checked);
      localStorage.setItem('musicEnabled', toggleMusic.checked);
      localStorage.setItem('soundVolume',   volSound.value);
      localStorage.setItem('musicVolume',   volMusic.value);
      settingsMenu.classList.add('hidden');
      mainMenu.style.display = 'grid';
      footer.style.display   = 'block';
    }

    // ‚îÄ‚îÄ‚îÄ N√≠veis ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function openLevels() {
      mainPage.style.display = 'none';
      levelsPage.classList.remove('hidden');
    }
    function closeLevels() {
      levelsPage.classList.add('hidden');
      mainPage.style.display = 'flex';
    }

    // ‚îÄ‚îÄ‚îÄ Carrega nome armazenado ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.onload = () => {
      const s = localStorage.getItem('playerName');
      if (s) nameSlot.textContent = s;
    };
  </script>

  <!-- script de levels.html (permanece igual) -->
  <script type="module">
    import { isLevelUnlocked, resetProgress } from "./js/unlockSystem.js";

    const levels = [
      { name: "N√≠vel 1", id: "level-1" },
      { name: "N√≠vel 2", id: "level-2" },
      { name: "N√≠vel 3", id: "level-3" },
      { name: "N√≠vel 4", id: "level-4" },
      { name: "N√≠vel 5", id: "level-5" },
      { name: "N√≠vel 6", id: "level-6" },
    ];
    const container = document.getElementById("levels-container");

    levels.forEach((lvl, idx) => {
      const card = document.createElement("div");
      card.className = "level-card";
      card.setAttribute("data-level", lvl.name.split(" ")[1]);

      const span = document.createElement("span");
      span.textContent = lvl.name;

      const btn = document.createElement("button");
      if (isLevelUnlocked(lvl.id)) {
        btn.textContent = "‚ñ∂ Jogar";
        btn.className   = "play-button";
        btn.onclick = () => {
          // 1) Guarda o n√≠vel selecionado
          localStorage.setItem("selectedLevel", lvl.id);

          // 2) Esconde o menu e mostra a p√°gina do jogo
          closeLevels();
          mainPage.classList.add("hidden");
          gamePage.classList.remove("hidden");

          // 3) Carrega dinamicamente o m√≥dulo main.js e inicia o n√≠vel
          import('./js/main.js').then(mod => {
            mod.initLevel(idx + 1);
          }).catch(err => {
            console.error("N√£o consegui carregar o jogo:", err);
          });
        };
      } else {
        btn.textContent = "üîí Bloqueado";
        btn.className   = "locked-button";
        btn.disabled    = true;
      }

      card.appendChild(span);
      card.appendChild(btn);
      container.appendChild(card);
    });

    document.getElementById("reset-btn").addEventListener("click", () => {
      if (confirm("Desejas reiniciar o progresso?")) {
        resetProgress();
        location.reload();
      }
    });
  </script>
</body>
</html>